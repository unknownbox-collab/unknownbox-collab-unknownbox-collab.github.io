<html>
    <head>
        <title>ANGRY BIRDS</title>
        <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js"></script>
        <script type="text/javascript" scr="https://github.com/mini2317/mini2317.github.io/blob/master/key.js"></script>
        <script>
            INIT ={
                x : 50,
                y : 500 - 100
            };
            cam = {
                x : 500,
                y : 250
            };
            G = 1;
            Pc = 1/2;

            function getRandomInt(min, max) {
                min = Math.ceil(min);
                max = Math.floor(max);
                return Math.floor(Math.random() * (max - min)) + min; //최댓값은 제외, 최솟값은 포함
            }

            var KEYCODE={
                BackSpace : 8,
                Tab : 9,
                Enter : 13,
                Shift : 16,
                Ctrl : 17,
                Alt : 18,
                Pause : 19,
                Break : 19,
                CapsLock : 20,
                Esc : 27,
                PageUp : 33,
                PageDown : 34,
                End : 35,
                Home : 36,
                Left : 37,
                Up : 38,
                Right : 39,
                Down : 40,
                Insert : 45,
                Delete : 46,
                0 : 48,
                1 : 49,
                2 : 50,
                3 : 51,
                4 : 52,
                5 : 53,
                6 : 54,
                7 : 55,
                8 : 56,
                9 : 57,
                a : 65,
                b : 66,
                c : 67,
                d : 68,
                e : 69,
                f : 70,
                g : 71,
                h : 72,
                i : 73,
                j : 74,
                k : 75,
                l : 76,
                m : 77,
                n : 78,
                o : 79,
                p : 80,
                q : 81,
                r : 82,
                s : 83,
                t : 84,
                u : 85,
                v : 86,
                w : 87,
                x : 88,
                y : 89,
                z : 90,
                Windows : 91,
                RightClick : 92,
                F1 : 112,
                F2 : 113,
                F3 : 114,
                F4 : 115,
                F5 : 116,
                F6 : 117,
                F7 : 118,
                F8 : 119,
                F9 : 120,
                F10 : 121,
                F11 : 122,
                F12 : 123,
                NumLock : 144,
                ScrollLock : 145
            };
            var Key={
                BackSpace : false,
                Tab : false,
                Enter : false,
                Shift : false,
                Ctrl : false,
                Alt : false,
                Pause : false,
                Break : false,
                CapsLock : false,
                Esc : false,
                PageUp : false,
                PageDown : false,
                End : false,
                Home : false,
                Left : false,
                Up : false,
                Right : false,
                Down : false,
                Insert : false,
                Delete : false,
                0 : false,
                1 : false,
                2 : false,
                3 : false,
                4 : false,
                5 : false,
                6 : false,
                7 : false,
                8 : false,
                9 : false,
                a : false,
                b : false,
                c : false,
                d : false,
                e : false,
                f : false,
                g : false,
                h : false,
                i : false,
                j : false,
                k : false,
                l : false,
                m : false,
                n : false,
                o : false,
                p : false,
                q : false,
                r : false,
                s : false,
                t : false,
                u : false,
                v : false,
                w : false,
                x : false,
                y : false,
                z : false,
                Windows : false,
                RightClick : false,
                F1 : false,
                F2 : false,
                F3 : false,
                F4 : false,
                F5 : false,
                F6 : false,
                F7 : false,
                F8 : false,
                F9 : false,
                F10 : false,
                F11 : false,
                F12 : false,
                NumLock : false,
                ScrollLock : false
            };
            var cursor={
                x : 0,
                y : 0,
                click:false
            };
            window.addEventListener('mousemove',function(e){
                cursor.x = e.x-document.getElementById("main").getBoundingClientRect().left;
                cursor.y = e.y-document.getElementById("main").getBoundingClientRect().top;
            });
            $(document).click(function (evt) {
                cursor.click = true;
            })
            $(document).keydown(function(e) {
                for (var i = 0; i < Object.keys(Key).length; i++) {
                    if (e.keyCode == KEYCODE[Object.keys(KEYCODE)[i]]) {
                        Key[Object.keys(KEYCODE)[i]] = true;
                    }
                }
            }).keyup(function(e) {
                for (var i = 0; i < Object.keys(Key).length; i++) {
                    if (e.keyCode == KEYCODE[Object.keys(KEYCODE)[i]]) {
                        Key[Object.keys(KEYCODE)[i]] = false;
                    }
                }
            });

            
            class Element{
                static ParseToRadian(degree){
                    return Math.PI*(degree-90)/180
                }
            
                static moveTo(x,y,delta,degree){
                    return {x:x + Math.cos(this.ParseToRadian(degree))*delta, y:y + Math.sin(this.ParseToRadian(degree))*delta}
                }

                static moveToTheta(x,y,delta,theta){
                    return {x:x + Math.cos(theta)*delta, y:y + Math.sin(theta)*delta}
                }

                draw(){}
            }

            class Vector{
                constructor(theta,k){
                    this.theta = theta;
                    this.k = k;
                }

                toPVector(){
                    return {
                        x : Math.cos(this.theta) * this.k,
                        y : Math.sin(this.theta) * this.k
                    }
                }

                getSize(){
                    return k
                }

                static toVector(PVector){
                    return new Vector(Math.atan2(PVector.y , PVector.x), Math.sqrt(PVector.x**2 + PVector.y**2))
                }
            }

            class Ball{
                constructor(x,y){
                    this.x = x;
                    this.y = y;
                    this.r = 10;
                    this.v = new Pysics(INIT,Pc,this).get_vector();
                }
            
                draw(){
                    var canvas = document.getElementById("main");
                    var ctx = canvas.getContext("2d");
                    ctx.beginPath();
                    ctx.fillStyle = "#FFFFFF";
                    ctx.strokeStyle = "#FFFFFF";
                    ctx.arc(this.x, this.y, this.r, 0, 2 * Math.PI);
                    ctx.fill();
                    ctx.stroke();
                }

                move(){
                    let moved = Element.moveToTheta(this.x,this.y,this.v.k,this.v.theta);
                    this.x = moved.x;
                    this.y = moved.y;
                    if (this.x <= 0){
                        this.x = 0;
                    }
                    if (this.x >= 1000){
                        this.x = 1000;
                    }
                    if (this.y <= 0){
                        this.y = 0;
                    }
                    if (this.y >= 500){
                        this.y = 500;
                    }
                    this.v = this.v.toPVector(this.v.theta,this.v.k);
                    this.v.y += G;
                    this.v = Vector.toVector(this.v);
                }
            }

            class Pysics{
                constructor(init,powerContant,ball){
                    this.init = init;
                    this.powerContant = powerContant;
                    this.theta = this.get_theta();
                    this.ball = ball;
                    this.g = G;
                }

                get_theta(){
                    return Math.atan2((this.init.y-cursor.y),(this.init.x-cursor.x))
                }

                get_vector(){
                    return new Vector(this.get_theta(), this.powerContant * (Math.sqrt((this.init.y-cursor.y)**2+(this.init.x-cursor.x)**2)))
                }

                get_th(){
                    v = this.get_vector();
                    return Math.sin(v.theta) * v.k / this.g
                }

                get_H(){
                    v = this.get_vector();
                    return {x : Math.cos(v.theta) * v.k * this.get_th() + this.init.x,
                            y : this.get_th() * v.k / 2 + this.init.y}
                }

                get_tf(){
                    v = this.get_vector();
                    return Math.sqrt(2*(this.get_H.y - this.ball.r)/this.g)
                }

                get_F(){
                    v = this.get_vector();
                    return {
                        x : Math.cos(v.theta) * v.k * (this.get_th() + this.get_tf(this.ball)) + this.init.x,
                        y : 0
                    }
                }

                getDots(){
                    return {
                        O : {
                            x : this.init.x,
                            y : this.init.y
                        },
                        H : this.get_H(),
                        F : this.get_F()
                    }
                }
            }

            function init(){
                //ball = new Ball(500,250,45,10);
                Calculator = new Pysics(INIT,Pc,new Ball(INIT.x,INIT.y));
                requestAnimationFrame(main);
            }
            
            balls = []
            function main(){
                var canvas = document.getElementById("main");
                var ctx = canvas.getContext("2d");
                ctx.beginPath();
                ctx.fillStyle = "#000000";
                ctx.strokeStyle = "#000000";
                ctx.fillRect(0, 0, 1000, 500);
                ctx.stroke();
                ctx.beginPath();
                ctx.fillStyle = "#FF0000";
                ctx.fillRect(INIT.x-5, INIT.y-5, 10, 10);
                ctx.stroke();
                if(cursor.click){
                    balls.push(new Ball(INIT.x,INIT.y));
                }
                balls.forEach(element => {
                    element.move();
                    element.draw();
                });
                cursor.click = false;
                requestAnimationFrame(main);
            }
        </script>
</head>
    <body onload="init()">
        <canvas id = "main" width="1000px" height="500px"></canvas>
    </body>
</html>